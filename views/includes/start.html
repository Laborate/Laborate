<!--
<% include ./printout.html %>
-->
<!DOCTYPE html>
<html itemscope="itemscope" itemtype="http://schema.org/WebPage" lang="en">
    <head>
        <% include ./meta.html %>

        <!-- CSS -->
        <%- css %>

        <!-- Site Config -->
        <script type="text/javascript">
            window.config = {
                csrf: "<%= csrf %>",
                host: "<%= host %>",
                port: <%= port || null %>,
                socket: "<%= socket %>",
                title: "<%= full_title %>",
                name: "<%= site_title %>",
                delimeter: "<%= site_delimeter %>",
                pageTrack: <%= pageTrack %>,
                gravatar: "<%= gravatar %>",
                logo: "<%= logos["500"] + random %>",
                apps: <%- JSON.stringify(apps) %>,
                icons: <%- JSON.stringify(icons) %>,
                logged_in: <%= (user && !user.fake) ? true : false %>,
                user: "<%= (user && !user.fake) ? user.pub_id : "" %>",
                social: {
                    <% $.each(social, function(key, value) { %>
                        <%= key %>: "<%= value.name %>",
                    <% }); %>
                },

                <% $.each(config, function(key, value) { %>
                    <% if(typeof value == "boolean") { %>
                        <%= key %>: <%- value %>,
                    <% } else if(typeof value == "object") { %>
                        <%= key %>: <%- JSON.stringify(value) %>,
                    <% } else if(typeof value == "number") { %>
                        <%= key %>: <%= value %>,
                    <% } else  { %>
                        <%= key %>: "<%= value %>",
                    <% } %>
                <% }); %>
            }
        </script>

        <!-- Javascript -->
        <%- js %>

        <!-- Raven Exception Handling -->
        <script type="text/javascript">
            Raven.config("<%= sentry %>").install();
            window.onerror = Raven.process;

            <% if(production) { %>
                $(function() {
                    console.log($("#printout").text());
                });
            <% } %>
        </script>

        <!-- Distance.io -->
        <script type='text/javascript'>
            var _paq = _paq || [];
            (function(){
                var u='https://distance.io/';
                _paq.push(['setSiteId', '531a596d3adb49ea27f774a6']);
                _paq.push(['trackPageView']);
                var d=document,
                    g=d.createElement('script'),
                    s=d.getElementsByTagName('script')[0];
                g.type='text/javascript';
                g.defer=true; g.async=true;
                g.src=u+'js/distance.js';
                s.parentNode.insertBefore(g,s);
            })();
        </script>
        <!-- End Distance.io Tracking Code -->

    </head>
    <body class="<%= (!organization.fake) ? "organization" : "" %> <%= (mobile) ? "mobile" : "" %> <%= (embed) ? "embed" : "" %>">
        <% if(production) { %>
            <div id="printout" class="hidden"><% include ./printout.html %></div>
        <% } %>
        <div class="error_popup <%= header_class %>"></div>
